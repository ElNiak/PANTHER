version: "3.7"
services:
  ivy-standalone:
    hostname: ivy-picotls-standalone
    container_name: ivy-picotls-standalone
    image: "ivy-picotls-standalone:latest"
    command: bash -c "python3 run_experiments.py --getstats --update_include_tls --webapp --compile  --docker"
    ports:
      - "49150:80"
    volumes:
      - /tmp/.X11-unix:/tmp/.X11-unix
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/webapp/:/tmp/QUIC-FormalVerification/webapp
      - ${PWD}/src/webapp/server.py:/tmp/QUIC-FormalVerification/webapp/server.py
      - ${PWD}/src/webapp/res/cytoscape_config.json:/tmp/cytoscape_config.json
      - ${PWD}/src/webapp/res/ivy_show_output.txt:/tmp/ivy_show_output.txt
      - ${PWD}/src/webapp/res/cytoscape_model.json:/tmp/cytoscape_model.json
      - ${PWD}/src/webapp/res/sample_model.json:/tmp/sample_model.json
      - ${PWD}/src/webapp/res/sample.json:/tmp/sample.json
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_init.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_init.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_compiler.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_compiler.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_parser.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_parser.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
    networks:
      - net
    privileged: true
    environment:
      - ROOT_PATH=${PWD} # TODO remove eventually
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
    restart: always

  # https://unix.stackexchange.com/questions/644176/how-to-permanently-add-self-signed-certificate-in-firefox
  ivy-visualizer:
    hostname: ivy-visualizer
    container_name: ivy-visualizer
    image: "ivy-visualizer:latest"
    command: ./startup_vizualizer.sh # NODE_OPTIONS=--openssl-legacy-provider
    ports:
      - "49149:80"
    #volumes:
    #  - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic/test/temp:/usr/src/vizualizer/public/temp
    networks:
      - net
    privileged: true
    restart: always
    depends_on:
      - ivy-standalone
  
  #################################################
  # Implementations workers
  #################################################

  # picoquic-ivy:
  #   hostname: picoquic-ivy
  #   container_name: picoquic-ivy
  #   image: "picoquic-ivy:latest"
  #   command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
  #   ports:
  #     - "49154:80"
  #   volumes:
  #     - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
  #     - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
  #     - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
  #     - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
  #     - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
  #     - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
  #     - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
  #     - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
  #     - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
  #     - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      # - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
  #     - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
  #     # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
  #     # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
  #     - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
  #     - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
  #     - /tmp/.X11-unix:/tmp/.X11-unix
  #   networks:
  #     - net
  #   privileged: true
  #   security_opt:
  #     - seccomp:unconfined
  #   cap_add:
  #     - NET_ADMIN
  #   tmpfs:
  #     - /dev/shm:rw,nosuid,nodev,exec,size=1024g
  #   environment:
  #     - DISPLAY=${DISPLAY}
  #     - XAUTHORITY=~/.Xauthority
  #     - MPLBACKEND='Agg'
  #   restart: always
  #   devices:
  #     - /dev/dri:/dev/dri
  #   depends_on:
  #     - ivy-standalone

  picoquic-shadow-ivy:
    hostname: picoquic-shadow-ivy
    container_name: picoquic-shadow-ivy
    image: "picoquic-shadow-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49156:80"
    volumes:
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone

  picoquic-shadow-bad-ivy:
    hostname: picoquic-shadow-bad-ivy
    container_name: picoquic-shadow-bad-ivy
    image: "picoquic-shadow-bad-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49157:80"
    volumes:
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone

  picoquic-old-shadow-ivy:
    hostname: picoquic-old-shadow-ivy
    container_name: picoquic-old-shadow-ivy
    image: "picoquic-old-shadow-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49158:80"
    volumes:
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone


  # quant-ivy:
  #   hostname: quant-ivy
  #   container_name: quant-ivy
  #   image: "quant-ivy:latest"
  #   command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
  #   ports:
  #     - "49155:80"
  #   volumes:
  #     - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
  #     - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
  #     - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      # - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
  #     - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
  #     - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
  #     # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
  #     # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
  #     - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
  #     - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
  #   networks:
  #     - net
  #   privileged: true
  #   restart: always
  #   depends_on:
  #     - ivy-standalone

  picoquic-no-retransmission-shadow-ivy:
    hostname: picoquic-no-retransmission-shadow-ivy
    container_name: picoquic-no-retransmission-shadow-ivy
    image: "picoquic-no-retransmission-shadow-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49159:80"
    volumes:
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone

  ping-pong:
    hostname: ping-pong-ivy
    container_name: ping-pong-ivy
    image: "ping-pong-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49160:80"
    volumes:
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone
    
  ping-pong-flaky:
    hostname: ping-pong-flaky-ivy
    container_name: ping-pong-flaky-ivy
    image: "ping-pong-flaky-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49161:80"
    volumes:
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone

  ping-pong-fail:
    hostname: ping-pong-fail-ivy
    container_name: ping-pong-fail-ivy
    image: "ping-pong-fail-ivy:latest"
    command: python3 run_experiments.py --update_include_tls --getstats --worker --compile  --docker
    ports:
      - "49162:80"
    volumes:
      - ${PWD}/src/app/run_experiments.py:/tmp/QUIC-FormalVerification/run_experiments.py
      - ${PWD}/src/webapp/worker.py:/tmp/QUIC-FormalVerification/webapp/worker.py
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/topo.gml
      - ${PWD}/src/app/res/shadow/shadow_client_test.yml:/tmp/QUIC-FormalVerification/shadow_client_test.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test.yml:/tmp/QUIC-FormalVerification/shadow_server_test.yml
      - ${PWD}/src/app/res/shadow/shadow_client_test_template.yml:/tmp/QUIC-FormalVerification/shadow_client_test_template.yml
      - ${PWD}/src/app/res/shadow/shadow_server_test_template.yml:/tmp/QUIC-FormalVerification/shadow_server_test_template.yml
      - ${PWD}/data/tls-keys:/tmp/QUIC-FormalVerification/tls-keys
      - ${PWD}/data/tickets:/tmp/QUIC-FormalVerification/tickets
      - ${PWD}/data/qlogs:/tmp/QUIC-FormalVerification/qlogs
      - ${PWD}/src/app/utils/:/tmp/QUIC-FormalVerification/utils/
      - ${PWD}/src/app/argument_parser/:/tmp/QUIC-FormalVerification/argument_parser/
      - ${PWD}/src/QUIC-Ivy-Attacker/doc/examples/quic:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/doc/examples/quic
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_to_cpp.py
      # - ${PWD}/src/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/ivy_cpp_types.py
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/
      - ${PWD}/src/QUIC-Ivy-Attacker/ivy/include/1.7:/tmp/QUIC-FormalVerification/QUIC-Ivy-Attacker/ivy/include/1.7
      - /tmp/.X11-unix:/tmp/.X11-unix
    networks:
      - net
    privileged: true
    security_opt:
      - seccomp:unconfined
    cap_add:
      - NET_ADMIN
    tmpfs:
      - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    environment:
      - DISPLAY=${DISPLAY}
      - XAUTHORITY=~/.Xauthority
      - MPLBACKEND='Agg'
    restart: always
    devices:
      - /dev/dri:/dev/dri
    depends_on:
      - ivy-standalone

  #################################################
  # PlantUML -> useless still only png or svg -> not dynamic
  #################################################

  # plantuml-server:
  #   image: jgraph/plantuml-server
  #   expose:
  #     - "8080"
  #   networks:
  #     - net
  #   volumes:
  #     - ./plantUML/fonts:/usr/share/fonts/drawio
  
  # image-export:
  #   image: jgraph/export-server
  #   expose:
  #     - "8000"
  #   networks:
  #     - net
  #   volumes:
  #     - ./plantUML/fonts:/usr/share/fonts/drawio

  # drawio:
  #   image: jgraph/drawio
  #   ports:
  #     - "8443:8443"
  #     - "8080:8080"
  #   depends_on:
  #     - plantuml-server
  #     - image-export
  #   networks:
  #     - net
  #   volumes:
  #     - ./plantUML/PostConfig.js:/usr/local/tomcat/webapps/draw/js/PostConfig.js
  #     - ./plantUML/PreConfig.js:/usr/local/tomcat/webapps/draw/js/PreConfig.js
  #   environment:
  #     - PLANTUML_URL=http://plantuml-server:8080/
  #     - EXPORT_URL=http://image-export:8000/

networks:
  net:
    driver: bridge
