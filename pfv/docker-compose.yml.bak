networks:
  net:
    external: true
    ipam:
      config:
      - subnet: 172.27.1.0/24
      driver: default
services:
  ivy-webapp:
    command: bash -c "python3 pfv_server.py"
    container_name: ivy-webapp
    environment:
    - ROOT_PATH=${PWD}
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    hostname: ivy-webapp
    image: ivy-webapp:latest
    networks:
      net:
        ipv4_address: 172.27.1.10
    ports:
    - 49150:80
    privileged: true
    restart: always
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/pfv_utils/:/app/pfv_utils/
    - ${PWD}/pfv/pfv_worker/app/configs/:/app/configs/
    - ${PWD}/pfv/pfv_worker/app/argument_parser/:/app/argument_parser/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_webapp/:/app/
  minip_ping_pong-ivy:
    command: python3 pfv_client.py
    container_name: minip_ping_pong-ivy
    depends_on:
    - ivy-webapp
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND="Agg"
    hostname: minip_ping_pong-ivy
    image: minip_ping_pong-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.10
    ports:
    - 49158:80
    privileged: true
    restart: always
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/output/tls-keys:/app/tls-keys
    - ${PWD}/pfv/output/tickets:/app/tickets
    - ${PWD}/pfv/output/qlogs:/app/qlogs
  picoquic-ivy:
    cap_add:
    - NET_ADMIN
    command: python3 pfv_client.py
    container_name: picoquic-ivy
    depends_on:
    - ivy-webapp
    devices:
    - /dev/dri:/dev/dri
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND='Agg'
    hostname: picoquic-ivy
    image: picoquic-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.4
    ports:
    - 49157:80
    privileged: true
    restart: always
    security_opt:
    - seccomp:unconfined
    tmpfs:
    - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_client_test.yml:/app/shadow_client_test.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_server_test.yml:/app/shadow_server_test.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_client_test_template.yml:/app/shadow_client_test_template.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_server_test_template.yml:/app/shadow_server_test_template.yml
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/output/tls-keys:/app/tls-keys
    - ${PWD}/pfv/output/tickets:/app/tickets
    - ${PWD}/pfv/output/qlogs:/app/qlogs
  picoquic-shadow-ivy:
    cap_add:
    - NET_ADMIN
    command: python3 pfv_client.py
    container_name: picoquic-shadow-ivy
    depends_on:
    - ivy-webapp
    devices:
    - /dev/dri:/dev/dri
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND='Agg'
    hostname: picoquic-shadow-ivy
    image: picoquic-shadow-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.3
    ports:
    - 49156:80
    privileged: true
    restart: always
    security_opt:
    - seccomp:unconfined
    tmpfs:
    - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_client_test.yml:/app/shadow_client_test.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_server_test.yml:/app/shadow_server_test.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_client_test_template.yml:/app/shadow_client_test_template.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_server_test_template.yml:/app/shadow_server_test_template.yml
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/output/tls-keys:/app/tls-keys
    - ${PWD}/pfv/output/tickets:/app/tickets
    - ${PWD}/pfv/output/qlogs:/app/qlogs
  ping-pong:
    cap_add:
    - NET_ADMIN
    command: python3 pfv_client.py
    container_name: ping-pong-ivy
    depends_on:
    - ivy-webapp
    devices:
    - /dev/dri:/dev/dri
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND='Agg'
    hostname: ping-pong-ivy
    image: ping-pong-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.5
    ports:
    - 49161:80
    privileged: true
    restart: always
    security_opt:
    - seccomp:unconfined
    tmpfs:
    - /dev/shm:rw,nosuid,nodev,exec,size=1024g
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_client_test.yml:/app/shadow_client_test.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_server_test.yml:/app/shadow_server_test.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_client_test_template.yml:/app/shadow_client_test_template.yml
    - ${PWD}/pfv/pfv_worker/app/res/shadow/shadow_server_test_template.yml:/app/shadow_server_test_template.yml
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/output/tls-keys:/app/tls-keys
    - ${PWD}/pfv/output/tickets:/app/tickets
    - ${PWD}/pfv/output/qlogs:/app/qlogs
  quic_picoquic-ivy:
    command: python3 pfv_client.py
    container_name: quic_picoquic-ivy
    depends_on:
    - ivy-webapp
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND="Agg"
    hostname: quic_picoquic-ivy
    image: quic_picoquic-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.10
    ports:
    - 49158:80
    privileged: true
    restart: always
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/output/tls-keys:/app/tls-keys
    - ${PWD}/pfv/output/tickets:/app/tickets
    - ${PWD}/pfv/output/qlogs:/app/qlogs
  quic_picoquic_shadow-ivy:
    command: python3 pfv_client.py
    container_name: quic_picoquic_shadow-ivy
    depends_on:
    - ivy-webapp
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND="Agg"
    hostname: quic_picoquic_shadow-ivy
    image: quic_picoquic_shadow-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.10
    ports:
    - 49158:80
    privileged: true
    restart: always
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/output/tls-keys:/app/tls-keys
    - ${PWD}/pfv/output/tickets:/app/tickets
    - ${PWD}/pfv/output/qlogs:/app/qlogs
version: '3.7'
