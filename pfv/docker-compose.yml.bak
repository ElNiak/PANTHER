networks:
  net:
    external: true
    ipam:
      config:
      - subnet: 172.27.1.0/24
      driver: default
services:
  ivy-webapp:
    command: bash -c "stty cols 100 rows 100 && python3 pfv_server.py"
    container_name: ivy-webapp
    devices:
    - /dev/dri:/dev/dri
    environment:
    - ROOT_PATH=${PWD}
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - COLUMNS=100
    - LINES=100
    hostname: ivy-webapp
    image: ivy-webapp:latest
    networks:
      net:
        ipv4_address: 172.27.1.10
    ports:
    - 49150:80
    privileged: true
    restart: always
    stdin_open: true
    tty: true
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_webapp/app/pfv_server.py:/app/pfv_server.py
    - ${PWD}/pfv/pfv_webapp/app/static/:/app/static/
    - ${PWD}/pfv/pfv_webapp/app/templates/:/app/templates/
    - ${PWD}/pfv/pfv_worker/app/pfv_utils/:/app/pfv_utils/
    - ${PWD}/pfv/pfv_worker/app/configs/:/app/configs/
    - ${PWD}/pfv/pfv_worker/app/argument_parser/:/app/argument_parser/
  picoquic-ivy:
    command: bash -c "stty cols 100 rows 100 && python3 pfv_client.py"
    container_name: picoquic-ivy
    depends_on:
    - ivy-webapp
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND="Agg"
    - COLUMNS=100
    - LINES=100
    hostname: picoquic-ivy
    image: picoquic-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.13
    ports:
    - 49162:80
    privileged: true
    restart: always
    stdin_open: true
    tty: true
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/outputs/tls-keys:/app/tls-keys
    - ${PWD}/pfv/outputs/tickets:/app/tickets
    - ${PWD}/pfv/outputs/qlogs:/app/qlogs
  picoquic-shadow-ivy:
    command: bash -c "stty cols 100 rows 100 && python3 pfv_client.py"
    container_name: picoquic-shadow-ivy
    depends_on:
    - ivy-webapp
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND="Agg"
    - COLUMNS=100
    - LINES=100
    hostname: picoquic-shadow-ivy
    image: picoquic-shadow-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.14
    ports:
    - 49163:80
    privileged: true
    restart: always
    stdin_open: true
    tty: true
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/outputs/tls-keys:/app/tls-keys
    - ${PWD}/pfv/outputs/tickets:/app/tickets
    - ${PWD}/pfv/outputs/qlogs:/app/qlogs
  ping-pong-ivy:
    command: bash -c "stty cols 100 rows 100 && python3 pfv_client.py"
    container_name: ping-pong-ivy
    depends_on:
    - ivy-webapp
    environment:
    - DISPLAY=${DISPLAY}
    - XAUTHORITY=~/.Xauthority
    - ROOT_PATH=${PWD}
    - MPLBACKEND="Agg"
    - COLUMNS=100
    - LINES=100
    hostname: ping-pong-ivy
    image: ping-pong-ivy:latest
    networks:
      net:
        ipv4_address: 172.27.1.12
    ports:
    - 49161:80
    privileged: true
    restart: always
    stdin_open: true
    tty: true
    volumes:
    - /tmp/.X11-unix:/tmp/.X11-unix
    - ${PWD}/pfv/pfv_worker/app/:/app/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/protocol-testing/:/app/pfv-ivy/protocol-testing/
    - ${PWD}/pfv/pfv_worker/app/pfv-ivy/ivy/:/app/pfv-ivy/ivy/
    - ${PWD}/pfv/outputs/tls-keys:/app/tls-keys
    - ${PWD}/pfv/outputs/tickets:/app/tickets
    - ${PWD}/pfv/outputs/qlogs:/app/qlogs
version: '3.7'
